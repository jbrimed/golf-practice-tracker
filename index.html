<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Practice Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }
        .tab-button {
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            border-bottom: 3px solid #10b981;
            color: #059669;
            font-weight: 600;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-800">Practice Tracker</h1>
            <p id="user-display" class="text-xs text-gray-500 bg-gray-100 p-2 rounded-lg">Local Mode</p>
        </div>

        <!-- Navigation Tabs -->
        <nav class="max-w-4xl mx-auto flex space-x-4 px-4">
            <button class="tab-button py-2 text-gray-600 hover:text-emerald-600" data-tab="quotas">Weekly Quotas</button>
            <button class="tab-button py-2 text-gray-600 hover:text-emerald-600" data-tab="drills">Drill Library</button>
            <button class="tab-button py-2 text-gray-600 hover:text-emerald-600" data-tab="log">Log Session</button>
            <button class="tab-button py-2 text-gray-600 hover:text-emerald-600" data-tab="history">History</button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-4 pb-12">

        <!-- Loading Spinner -->
        <div id="loading" class="text-center text-gray-500 mt-12">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500 mx-auto"></div>
            <p class="mt-2">Loading tracker...</p>
        </div>

        <div id="tab-content" class="space-y-6 hidden">

            <!-- WEEKLY QUOTAS -->
            <section id="quotas" class="tab-pane hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Weekly Quotas</h2>
                <div class="card p-6 space-y-4">
                    <div id="quotas-list" class="space-y-4"></div>
                </div>
            </section>

            <!-- DRILL LIBRARY -->
            <section id="drills" class="tab-pane hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Drill Library</h2>
                <div id="drill-list" class="space-y-6"></div>
            </section>

            <!-- LOG SESSION -->
            <section id="log" class="tab-pane hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Log a Practice Session</h2>

                <form id="session-log-form" class="card p-6 space-y-4">

                    <h3 class="font-bold text-lg text-emerald-700">Session Details</h3>

                    <input type="date" id="log-date" class="w-full p-2 border rounded-lg" required>
                    <input type="text" id="log-clubs" placeholder="Driver, 7I, SW" class="w-full p-2 border rounded-lg" required>
                    <input type="text" id="log-intent" placeholder="Face control / start line" class="w-full p-2 border rounded-lg" required>

                    <h3 class="font-bold text-lg text-emerald-700 pt-4 border-t">Performance</h3>

                    <input type="number" id="log-startline-perc" placeholder="Start line %" class="w-full p-2 border rounded-lg" min="0" max="100" required>

                    <select id="log-strike-pattern" class="w-full p-2 border rounded-lg" required>
                        <option disabled selected>Select strike pattern</option>
                        <option value="center">Center</option>
                        <option value="heel">Heel</option>
                        <option value="toe">Toe</option>
                        <option value="varied">Varied</option>
                    </select>

                    <textarea id="log-notes" placeholder="Session notes..." class="w-full p-2 border rounded-lg"></textarea>

                    <button class="w-full bg-emerald-600 text-white p-3 rounded-xl font-semibold hover:bg-emerald-700">
                        Save Session
                    </button>
                </form>

                <div id="log-message" class="mt-4 hidden p-3 rounded-lg text-sm font-medium"></div>

            </section>

            <!-- HISTORY -->
            <section id="history" class="tab-pane hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Session History</h2>
                <div id="sessions-list" class="space-y-4"></div>
                <p id="no-sessions" class="hidden text-center text-gray-500 mt-8">No sessions logged.</p>
            </section>

        </div>
    </main>

</div>

<script type="module">
    import { PRACTICE_QUOTAS, DRILL_LIBRARY } from "./data.js";
    import { saveQuotaState, loadQuotaState, saveSession, loadSessions } from "./storage.js";

    // ----- UI Setup -----

    window.onload = () => {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('tab-content').classList.remove('hidden');
        document.getElementById('log-date').valueAsDate = new Date();

        switchTab("quotas");
        renderQuotas();
        renderDrills();
        renderSessionHistory();

        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) =>
                switchTab(e.target.getAttribute('data-tab'))
            );
        });

        document.getElementById("session-log-form").addEventListener("submit", handleSessionSubmit);
    };

    // ----- Tab Switching -----

    function switchTab(targetTabId) {
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-tab') === targetTabId);
        });

        document.querySelectorAll('.tab-pane').forEach(pane => {
            pane.classList.toggle('hidden', pane.id !== targetTabId);
        });
    }

    // ----- Render Quotas -----

    function renderQuotas() {
        const list = document.getElementById("quotas-list");
        list.innerHTML = "";

        const saved = loadQuotaState();

        Object.entries(PRACTICE_QUOTAS).forEach(([category, drills]) => {
            list.insertAdjacentHTML('beforeend', `<h3 class='font-bold pt-4'>${category}</h3>`);

            drills.forEach(drill => {
                const checked = saved[drill.key] === true;
                list.insertAdjacentHTML('beforeend', `
                    <label class="flex items-center p-3 border rounded-xl cursor-pointer bg-white">
                        <input type="checkbox" data-key="${drill.key}" ${checked ? "checked" : ""} class="mr-3 quota-checkbox">
                        <span>${drill.label}</span>
                    </label>
                `);
            });
        });

        document.querySelectorAll('.quota-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                saveQuotaState(e.target.getAttribute('data-key'), e.target.checked);
            });
        });
    }

    // ----- Render Drill Library -----

    function renderDrills() {
        const list = document.getElementById("drill-list");
        list.innerHTML = "";

        Object.entries(DRILL_LIBRARY).forEach(([category, drills]) => {
            list.insertAdjacentHTML('beforeend', `<h3 class="font-bold pt-6">${category}</h3>`);

            drills.forEach(drill => {
                list.insertAdjacentHTML('beforeend', `
                    <details class="card p-4 border">
                        <summary class="cursor-pointer text-emerald-700 font-semibold">${drill.name}</summary>
                        <p class="text-sm text-gray-600 mt-3">${drill.description}</p>
                        <ul class="text-xs mt-3 text-gray-500 list-disc ml-4">
                            ${drill.criteria.map(c => `<li>${c}</li>`).join("")}
                        </ul>
                    </details>
                `);
            });
        });
    }

    // ----- Save Session -----

    function handleSessionSubmit(event) {
        event.preventDefault();

        const session = {
            date: document.getElementById("log-date").value,
            clubs: document.getElementById("log-clubs").value,
            intent: document.getElementById("log-intent").value,
            startline: document.getElementById("log-startline-perc").value,
            strike: document.getElementById("log-strike-pattern").value,
            notes: document.getElementById("log-notes").value,
            timestamp: Date.now()
        };

        saveSession(session);
        renderSessionHistory();

        document.getElementById("log-message").textContent = "Saved!";
        document.getElementById("log-message").classList.remove("hidden");

        event.target.reset();
    }

    // ----- Render Session History -----

    function renderSessionHistory() {
        const sessions = loadSessions();
        const list = document.getElementById("sessions-list");
        const none = document.getElementById("no-sessions");

        list.innerHTML = "";

        if (sessions.length === 0) {
            none.classList.remove("hidden");
            return;
        }

        none.classList.add("hidden");

        sessions.slice().reverse().forEach(s => {
            list.insertAdjacentHTML('beforeend', `
                <div class="card p-5 border">
                    <h3 class="text-lg font-bold text-emerald-700">${new Date(s.timestamp).toLocaleDateString()}</h3>
                    <p><strong>Clubs:</strong> ${s.clubs}</p>
                    <p><strong>Intent:</strong> ${s.intent}</p>
                    <p><strong>Start-line:</strong> ${s.startline}%</p>
                    <p><strong>Strike:</strong> ${s.strike}</p>
                    <p class="mt-2 text-gray-600">${s.notes || 'No notes'}</p>
                </div>
            `);
        });
    }

</script>
</body>
</html>
